<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <record id="view_islr_wh_doc_invoices_form_" model="ir.ui.view">
            <field name="name">islr.wh.doc.invoices_form</field>
            <field name="model">islr.wh.doc.invoices</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Invoices">
                    <field
                        name="invoice_id"
                        domain="[('partner_id','=',parent.partner_id),('islr_wh_doc_id', '=', False),('state', '=', 'open'),('invoice_line.concept_id.withholdable', '=', True)]"
                        colspan='6'/>
                    <newline/>
                    <field name="islr_xml_id" nolabel="1"  colspan='4'>
                        <tree string="Detail of the Concept of Withholding Income">
                            <field name="rate_id"/>
                            <field name="wh"/>
                            <field name="porcent_rete"/>
                            <field name="base"/>
                        </tree>
                    </field>
                    <field name="amount_islr_ret"/>
                    <field name="base_ret"/>
                    <button type='object' name='load_taxes' string='Load taxes' icon='gtk-execute'/>
                </form>
            </field>
        </record>

    <!-- 
    =====================================================
    Retention ISLR DOC, DOC LINE  CUSTOMERS
    =====================================================
    -->

        <record id="view_wh_islr_filter_customer" model="ir.ui.view">
            <field name="name">islr.wh.doc.search</field>
            <field name="model">islr.wh.doc</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search Withholding Income">
                   <group col="10" colspan="4">
                        <filter name="to_process" icon="terp-gtk-go-back-rtl" string="To Process" domain="[('state','=','to_process')]" help="To Process Withholding Income"/>
                        <filter name="draft" icon="terp-gtk-media-pause" string="Draft" domain="[('state','=','draft')]" help="Draft Withholding Income"/>
                        <filter name="confirmed" icon="terp-camera_test" string="Confirmed" domain="[('state','=','confirmed')]" help="Confirmed Withholding Income"/>
                        <filter name="done" icon="terp-check" string="Done" domain="[('state','=','done')]" help="Done Withholding Income"/>
                        <filter name="cancel" icon="terp-dialog-close" string="Cancel" domain="[('state','=','cancel')]" help="Cancel Withholding Income"/>
                        <separator orientation="vertical"/>
                        <field name="code"/>
                        <field name="partner_id"/>
                        <field name="journal_id"  select="1" widget="selection" string="Journal"/>
                        <field name="user_id" select="1" widget="selection" string="Salesman">
                        <filter domain="[('user_id','=',uid)]" help="My Withholding Income" icon="terp-personal" separator="1"/>
                        </field>
                    </group>
                    <newline/>
                    <group col="10" colspan="4">
                        <field name="date_ret" string="Fecha Contable"/>
                        <field name="date_uid" string="Fecha Comprobante"/>
                    </group>
                    <newline/>
                    <group expand="1" string="Group By...">
                        <filter string="Partner" icon="terp-partner" domain="[]" context="{'group_by':'partner_id'}"/>
                        <separator orientation="vertical"/>
                        <filter string="State" icon="terp-stock_effects-object-colorize" domain="[]"  context="{'group_by':'state'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Accounting Date of Withhold" icon="terp-go-month" domain="[]"  context="{'group_by':'date_ret'}"/>
                    </group>
               </search>
            </field>
        </record>

        <record id="view_islr_line_tree" model="ir.ui.view">
            <field name="name">islr.wh.doc_line_tree</field>
            <field name="model">islr.wh.doc.line</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Lines Withholding Income" editable="bottom" >
                    <field name="name"/>
                    <field name="concept_id"/>
                    <field name="retencion_islr"/>
                    <field name="amount"/>
                    <field name="move_id"/>
                </tree>
            </field>
        </record>

        <record id="view_islr_line_form" model="ir.ui.view">
            <field name="name">islr.wh.doc.line_form</field>
            <field name="model">islr.wh.doc.line</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Lines Withholding Income">
                    <field name="concept_id"  colspan='6'/>
                    <field name="move_id"  colspan='6'/>
                    <newline/>
                    <field name="xml_ids" nolabel="1"  colspan='4'>
                        <tree string="Detail of the Concept of Withholding Income">
                            <field name="rate_id"/>
                            <field name="wh"/>
                            <field name="porcent_rete"/>
                            <field name="base"/>
                        </tree>
                    </field>
                </form>
            </field>
        </record>

        <record id="view_islr_tree_customers" model="ir.ui.view">
            <field name="name">islr.wh.doc_tree_customers</field>
            <field name="model">islr.wh.doc</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree colors="blue:state=='draft'" string="Customer Withholding Income">
                    <field name="partner_id"/>
                    <field name="date_ret"/>
                    <field name="period_id"/>
                    <field name="number"/>
                    <field name="code"/>
                    <field name="invoice_id"/>
                    <field name="amount_total_ret"/>
                    <field name="currency_id"/>
                    <field name="state" invisible="1"/>
                </tree>
            </field>
        </record>

        <record id="view_islr_form_customers" model="ir.ui.view">
            <field name="name">islr.wh.doc_form_customers</field>
            <field name="model">islr.wh.doc</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Customer Withholding Income">
                    <group colspan="4" col="6">
                        <field name="journal_id" domain="[('type','=','islr_sale')]"/>
                        <field name="type"/>
                        <field name="code"/>
                        <field name="partner_id" on_change="onchange_partner_id(type,partner_id)" domain="[('islr_withholding_agent','=',True), ('customer','=',True)]"/>
                        <field name="currency_id" />
                        <field name="date_ret" />
                        <field domain="[('type','&lt;&gt;','view'), ('company_id', '=', company_id)]" name="account_id"/>
                        <field name="name"/>
                        <field name="period_id"/>
                        <field name="date_uid"/>
                    </group>
                            <notebook colspan="6">
                                <page string="Invoices">
                                    <field domain="[('partner_id','=',partner_id),('status','=','no_pro'),('state','in',['open','paid']),('type','in',['out_invoice','out_refund'])]" colspan="6" name="islr_wh_doc_id" nolabel="1" widget="many2many"/>
                                </page>
                                    <field name="amount_islr_ret"/>
                                    <field name="base_ret"/>
                                <page string="Concept of Withholding Income">
                                    <field colspan="6" name="concept_ids" nolabel="1" widget="one2many_list"/>
                                        <group col="4" colspan="2">
                                            <field name="amount_total_ret"/>
                                        </group>
                                </page>
                               <page string="Other Information">
                                    <field name="company_id"/>
                                </page>
                            </notebook>
                        <group colspan="6" col="2">
                        <group col="1">
                            <field name="state"/>
                            <button name="act_progress" string="Progress" states="draft" icon="gtk-go-forward"/>
                            <button name="act_confirmed" string="Confirmed" states="progress" icon="gtk-go-forward"/>
                            <button name="act_done" string="Done" states="confirmed" icon="gtk-execute" />
                            <button name="%(voucher_report_withholding_islr)d" string="Print Withholding Income" states="done" colspan="3" type="action" icon="gtk-execute"/>
                            <button name="act_cancel" string="Cancel" states="draft,progress,confirmed,done"  icon="gtk-cancel"  />
                            <button name="act_draft" colspan="2" string="Set to draft" states="cancel" icon="gtk-go-forward"/>
                        </group>
                        </group>
                </form>
            </field>
        </record>

    <!-- 
    =====================================================
    Retention ISLR DOC, DOC LINE, SUPPLIERS
    =====================================================
    -->

        <record id="view_wh_islr_filter_suppliers" model="ir.ui.view">
            <field name="name">islr.wh.doc.search</field>
            <field name="model">islr.wh.doc</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search Withholding Income">
                   <group col="10" colspan="4">
                        <filter name="draft" icon="terp-gtk-media-pause" string="Draft" domain="[('state','=','draft')]" help="Draft Withholding Income"/>
                        <filter name="confirmed" icon="terp-camera_test" string="Confirmed" domain="[('state','=','confirmed')]" help="Confirmed Withholding Income"/>
                        <filter name="done" icon="terp-check" string="Done" domain="[('state','=','done')]" help="Done Withholding Income"/>
                        <filter name="cancel" icon="terp-dialog-close" string="Cancel" domain="[('state','=','cancel')]" help="Cancel Withholding Income"/>
                        <separator orientation="vertical"/>
                        <field name="code"/>
                        <field name="partner_id"/>
                        <field name="journal_id"  select="1" widget="selection" string="Journal"/>
                        <newline/>
                        <field name="date_ret" string="Fecha Contable"/>
                        <field name="date_uid" string="Fecha Comprobante"/>
                    </group>
                    <newline/>
                    <group expand="1" string="Group By...">
                        <filter string="Partner" icon="terp-partner" domain="[]" context="{'group_by':'partner_id'}"/>
                        <separator orientation="vertical"/>
                        <filter string="State" icon="terp-stock_effects-object-colorize" domain="[]"  context="{'group_by':'state'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Accounting Date of Withhold" icon="terp-go-month" domain="[]"  context="{'group_by':'date_ret'}"/>
                    </group>
               </search>
            </field>
        </record>

        <record id="view_wh_islr_tree_suppliers" model="ir.ui.view">
            <field name="name">islr.wh.doc_tree_suppliers</field>
            <field name="model">islr.wh.doc</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree colors="blue:state=='draft'" string="Supplier Withholding Income">
                    <field name="partner_id"/>
                    <field name="date_ret"/>
                    <field name="period_id"/>
                    <field name="number"/>
                    <field name="code"/>
                    <field name="invoice_id"/>
                    <field name="amount_total_ret"/>
                    <field name="currency_id"/>
                    <field name="state" invisible="1"/>
                </tree>
            </field>
        </record>

        <record id="view_islr_line_tree" model="ir.ui.view">
            <field name="name">islr.wh.doc_line_tree2</field>
            <field name="model">islr.wh.doc.line</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Lines Withholding Income" editable="bottom" >
                    <field name="name"/>
                    <field name="concept_id"/>
                    <field name="retencion_islr"/>
                    <field name="amount"/>
                    <field name="move_id"/>
                </tree>
            </field>
        </record>

        <record id="view_islr_line_form" model="ir.ui.view">
            <field name="name">islr.wh.doc.line_form2</field>
            <field name="model">islr.wh.doc.line</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Lines Withholding Income">
                    <field name="concept_id"  colspan='6'/>
                    <field name="move_id"  colspan='6'/>
                    <newline/>
                    <field name="xml_ids" nolabel="1"  colspan='4'>
                        <tree string="Detail of the Concept of Withholding Income">
                            <field name="rate_id"/>
                            <field name="wh"/>
                            <field name="porcent_rete"/>
                            <field name="base"/>
                        </tree>
                    </field>
                </form>
            </field>
        </record>


        <record id="view_wh_islr_form_suppliers" model="ir.ui.view">
            <field name="name">islr.wh.doc_form_suppliers</field>
            <field name="model">islr.wh.doc</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Supplier Withholding Income">
                    <group colspan="4" col="6">
                        <field name="journal_id" domain="[('type','=','islr_purchase')]"/>
                        <field name="type"/>
                        <field name="code"/>
                        <field name="partner_id" on_change="onchange_partner_id(type,partner_id)" domain="[('supplier','=',True)]"/>
                        <field name="currency_id" />
                        <field name="date_ret" />
                        <field domain="[('type','&lt;&gt;','view'), ('company_id', '=', company_id)]" name="account_id"/>
                        <field name="name"/>
                        <field name="period_id"/>
                        <field name="number"/>
                        <field name="date_uid" />
                        <field name="invoice_id" />
                    </group>
                            <notebook colspan="6">
                                <page string="Invoices">
                                    <field domain="[('partner_id','=',partner_id),('status','=','no_pro'),('state','in',['open','paid']),('type','in',['in_invoice','in_refund'])]" colspan="6" name="islr_wh_doc_id" nolabel="1" widget="many2many"/>
                                    <field name="amount_islr_ret"/>
                                    <field name="base_ret"/>
                                </page>
                                <page string="Concept of Withholding Income">
                                    <field colspan="6" name="concept_ids" nolabel="1" widget="one2many_list"/>
                                        <group col="4" colspan="2">
                                            <field name="amount_total_ret"/>
                                        </group>
                                </page>
                                <page string="Invoices" invisible="1">
                                    <field name="invoice_ids" nolabel="1">
                                        <tree string="Invoices Withhelds">
                                            <field name="invoice_id"/>
                                        </tree>
                                    </field>
                                </page>
                               <page string="Other Information">
                                    <field name="company_id"/>
                                </page>
                            </notebook>
                        <group colspan="6" col="2">
                        <group col="1">
                            <field name="state"/>
                            <button name="act_progress" string="Progress" states="draft" type="workflow"  icon="gtk-go-forward"/>
                            <button name="act_confirmed" string="Confirmed" states="progress" type="workflow"  icon="gtk-go-forward"/>
                            <button name="act_done" string="Done" states="confirmed" type="workflow"  icon="gtk-go-forward"/>
                            <button name="%(voucher_report_withholding_islr)d" string="Print Withholding Income" colspan="3" states="done" type="action" icon="gtk-execute"/>
                            <button name="act_cancel" string="Cancel" states="draft,progress,confirmed,done" type="workflow"   icon="gtk-go-forward"/>
                            <button name="act_draft"  colspan="2"  string="Set to draft" states="cancel" type="workflow"  icon="gtk-go-forward"/>
                        </group>
                        </group>
                </form>
            </field>
        </record>


        <record model="ir.actions.act_window" id="action_wh_islr_customer">
            <field name="name">Customer Withholding Income</field>
            <field name="res_model">islr.wh.doc</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field name="domain">[('type','=','out_invoice')]</field>
            <field name="context">{'type':'out_invoice'}</field>
            <field name="search_view_id" ref="view_wh_islr_filter_customer"/>
            <field name="help">With Customer Withholding  you can create and manage document withholding issued to your customers. OpenERP can also generate document withholding automatically from invoices.For retention must add the invoices, process them and then validate the document.</field>
        </record>
        <record model="ir.actions.act_window.view" id="action_wh_islr_customer_tree">
            <field name="sequence" eval="10"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_islr_tree_customers"/> 
            <field name="act_window_id" ref="action_wh_islr_customer"/>
        </record>
        <record model="ir.actions.act_window.view" id="action_wh_islr_customer_form">
            <field name="sequence" eval="20"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_islr_form_customers"/>
            <field name="act_window_id" ref="action_wh_islr_customer"/>
        </record>

        <menuitem
            id="menu_action_wh_islr_customer"
            name="Customer Withholding Income"
            parent="account.menu_finance_receivables"
            action="action_wh_islr_customer"/>

        <record model="ir.actions.act_window" id="action_wh_islr_supplier">
            <field name="name">Supplier Withholding Income</field>
            <field name="res_model">islr.wh.doc</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field name="domain">[('type','=','in_invoice')]</field>
            <field name="context">{'type':'in_invoice', 'search_default_draft': 1}</field>
            <field name="search_view_id" ref="view_wh_islr_filter_suppliers"/>
            <field name="help">With Supplier Withholding  you can manage document withholding issued to your suppliers. OpenERP can Just generate document withholding for purchase process automatically from invoices. To generate the withholding income and all accounting process you must confirm and validate the document withholding.</field>

        </record>
        <record model="ir.actions.act_window.view" id="action_wh_islr_tree">
            <field name="sequence" eval="10"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_wh_islr_tree_suppliers"/> 
            <field name="act_window_id" ref="action_wh_islr_supplier"/>
        </record>
        <record model="ir.actions.act_window.view" id="act_wh_islr_form">
            <field name="sequence" eval="20"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_wh_islr_form_suppliers"/>
            <field name="act_window_id" ref="action_wh_islr_supplier"/>
        </record>

        <menuitem
            id="menu_action_wh_islr_supplier"
            name="Supplier Withholding Income" 
            parent="account.menu_finance_payables"
            action="action_wh_islr_supplier"/>

    </data>
</openerp>





