-
  3. Testing Customer Withholding documents generated manually (sale).
-
  3.1 Checking and configuring the elements needed.
-
  Check if the journal is of sale type.
-
    !assert {model: account.journal, id: account.sales_journal, string: The journal is not of sale type}:
        - type == 'sale'
-
  Check if the account is of type receivable.
-
    !assert {model: account.account, id: account.a_recv, string: The account is not of receivable type}:
        - type == 'receivable'
-
  Customer A is withholding agent.
-
    !assert {model: res.partner, id: l10n_ve_fiscal_requirements.f_req_partner_1, string: Customer A is not a withholding agent}:
        - wh_iva_agent
-
  Customer B is not withholding agent.
-
    !assert {model: res.partner, id: l10n_ve_fiscal_requirements.f_req_partner_7, string: Customer B is a withholding agent}:
        - wh_iva_agent == False
-
  ---- TODO here are missing checkings. not defined yet
-  
-
  Setting the context that will be used for the encoding of all the withholding documents
-
  !context
    'type': 'out_invoice'
-
  3.2 Test customer withholding when the company is not a withholding agent.
-
  Set the company partner as a non-withholding agent.
-
    !record {model: res.partner, id: base.main_partner}:
        wh_iva_agent: False
-
  Checking that the Company partner is not withholding agent.
-
    !assert {model: res.partner, id: base.main_partner, string: The Company is a withholding agent}:
        - not wh_iva_agent
-
  Create a Customer Withholding 
-
    !record {model: account.wh.iva, id: awi_sale_base, view: l10n_ve_withholding_iva.view_wh_iva_form_customer}: &sale_wh_iva
        number: Customer Withholding Base
        name: Customer Withholding Base
        partner_id: l10n_ve_fiscal_requirements.f_req_partner_1
        account_id: account.a_recv
        journal_id: account.sales_journal
        company_id: base.main_company
        currency_id: base.EUR
-
  I check that the customer withholding is in draft state.
-
  !assert {model: account.wh.iva, id: awi_sale_base, string: the withholding iva is not in draft state. It needs to be when is just created}:
    - state == 'draft'
-
  I check that the customer withholding is out_invoice type.
-
  !assert {model: account.wh.iva, id: awi_sale_base, string: Not the intended type. It should be 'out_invoice'}:
    - type == 'out_invoice'
-
  Search current period and atach to the withholding iva doc.
-
  !python {model: account.wh.iva}: |
    import time
    awi_id = ref("awi_sale_base")
    period_obj = self.pool.get('account.period')
    period = period_obj.find(cr, uid, time.strftime('%Y/%m/%d'), {'company_id':ref('base.main_company')})
    assert period, 'There aren\'t periods for this date'
    self.write(cr, uid, awi_id, {'period_id':period[0]})
-
  Case 000 (Non-wh Company, Non-wh Partner, Non-ret Tax)
-
-
  Case 001 (Non-wh Company, Non-wh Partner, Ret Tax)
-
-
  Case 00N (Non-wh Company, Non-wh Partner, No Tax)
-
-
  Case 010 (Non-wh Company, Wh Partner, Non-ret Tax)
-
-
  Case 011 (Non-wh Company, Wh Partner, Ret Tax)
-
-
  Case 01N (Non-wh Company, Wh Partner, No Tax)
-
-
  3.3 Test customer withholding when the company is a withholding agent.
-
  Set the company partner as a withholding agent.
-
    !record {model: res.partner, id: base.main_partner}:
        wh_iva_agent: True
-
  Checking that the Company partner is a withholding agent.
-
    !assert {model: res.partner, id: base.main_partner, string: The Company is not a withholding agent}:
        - wh_iva_agent
-
  Case 100 (Wh Company, Non-wh Partner, Non-ret Tax)
-
-
  Case 101 (Wh Company, Non-wh Partner, Ret Tax)
-
-
  Case 10N (Wh Company, Non-wh Partner, No Tax)
-
-
  Case 110 (Wh Company, Wh Partner, Non-ret Tax)
-
-
  Case 111 (Wh Company, Wh Partner, Ret Tax)
-
-
  Case 11N (Wh Company, Wh Partner, No Tax)
-
