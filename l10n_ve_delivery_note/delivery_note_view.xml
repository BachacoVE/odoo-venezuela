<?xml version="1.0"?>
<openerp>
    <data>
    <!--
    =======================
    DELIVERY NOTE
    =======================
    -->

        <record id="view_delivery_note_tree" model="ir.ui.view">
            <field name="name">delivery.note.line.tree</field>
            <field name="model">delivery.note.line</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Delivery Note Line">
                    <field name="name"/>
                    <field name="product_id"/>
                    <field name="quantity"/>
                    <field name="uos_id"/>
                    <field name="price_unit"/>
                    <field name="discount"/>
                    <field name="price_subtotal"/>
                </tree>
            </field>
        </record>

        <record id="view_delivery_note_line_form" model="ir.ui.view">
            <field name="name">delivery.note.line.form</field>
            <field name="model">delivery.note.line</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Delivery Note Line">
                    <notebook>
                        <page string="Line">
<!--
                            <field name="product_id" on_change="product_id_change(product_id, uos_id, quantity, name, parent.type, parent.partner_id, parent.fiscal_position, price_unit)" select="1"/>
-->
                            <field name="product_id" select="1"/>
                            <field name="uos_id"/>
                            <field name="quantity" select="1"/>
                            <field name="price_unit" select="1"/>
                            <newline/>
                            <field name="discount"/>
                            <field name="price_subtotal"/>
                            <field colspan="4" name="note_line_tax_id" domain="[('parent_id','=',False),('company_id', '=', parent.company_id)]"/>
                        </page>
                        <page string="Notes">
                            <field colspan="4" name="note" nolabel="1"/>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

        <record id="delivery_note_tree" model="ir.ui.view">
            <field name="name">delivery.note.tree</field>
            <field name="model">delivery.note</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree colors="blue:state=='draft'" string="Delivery Note">
                    <field name="number"/>
                    <field name="partner_id"/>
                    <field name="amount_untaxed" sum="Untaxed amount"/>
                    <field name="amount_total" sum="Total amount"/>
                    <field name="currency_id"/>
                    <field name="date_note" select="1"/>
                    <field name="invoice_state" select="1"/>
                    <field name="state" select="1"/>
                </tree>
            </field>
        </record>

        <record id="delivery_note_form" model="ir.ui.view">
            <field name="name">delivery.note.form</field>
            <field name="model">delivery.note</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Delivery Note">
                    <group colspan="4" col="6">
                        <field name="partner_id" on_change="onchange_partner_id(partner_id,date_note,payment_term)" select="1" groups="base.group_user"/>
                        <field domain="[('partner_id','=',partner_id)]" name="address_invoice_id"/>
                        <field domain="[('partner_id','=',partner_id)]" name="address_shipping_id"/>
                        <field name="invoice_state"/>
                        <field name="picking_id"/>
                        <field name="sale_id"/>
                        <field name="number" select="1"/>
                        <field name="currency_id" select="2"/>
                        <field name="date_note" select="2"/>
                    </group>
                    <notebook colspan="4">
                        <page string="Delivery Note">
                            <field colspan="4" name="note_line" nolabel="1" widget="one2many_list"/>
                            <group col="1" colspan="2">
                                <field name="tax_line" nolabel="1">
                                    <tree editable="bottom" string="Taxes">
                                        <field name="name"/>
                                        <field name="base" on_change="base_change(base,parent.currency_id,parent.company_id,parent.date_invoice)" readonly="1"/>
                                        <field name="amount" on_change="amount_change(amount,parent.currency_id,parent.company_id,parent.date_note)"/>
                                        <field invisible="True" name="base_amount"/>
                                        <field invisible="True" name="tax_amount"/>
                                    </tree>
                                </field>
                            </group>
                            <group col="4" colspan="2">
                                <button colspan="2" name="button_reset_taxes" states="draft" string="Compute Taxes" type="object" groups="base.group_user"/>
                                <field name="amount_untaxed"/>
                                <label string="" colspan="2"/>
                                <field name="amount_tax"/>
                                <field name="state" select="2"/>
                                <field name="amount_total"/>
                                
                                <group col="4" colspan="4">
                                    <button icon="gtk-ok" states="draft,proforma" name="delivery_note_open" string="Create Delivery Note" type="object"/>
                                    <button icon="gtk-convert" states="cancel" name="action_cancel_draft" string="Set to Draft" type="object"/>
                                    <button icon="gtk-cancel" states="draft,proforma,open" name="delivery_note_cancel" string="Cancel" type="object"/>                                    
                                </group>
                            </group>
                        </page>
                        <page string="Notes">
                            <field colspan="4" name="note" nolabel="1"/>
                        </page>
                        <page string="Other Info">
                            <group col="3" colspan="4">
                                <field name="nro_ctrl"/>
                                <button states="open,done" name="%(wiz_set_nro_ctrl)d" string="Change Ctrl No." type="action"/>
                            </group>
                            <field name="company_id"/>
                            <field name="payment_term"/>
                            <separator colspan="4" string="Additionnal Information"/>
                            <field colspan="4" name="comment" nolabel="1"/>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>


        <record model="ir.actions.act_window" id="action_wizard_delivery_note_form">
            <field name="name">Delivery Note</field>
            <field name="res_model">delivery.note</field>
            <field name="view_type">form</field>
            <field name="view_mode">form,tree</field>
            <field name="view_id" eval="delivery_note_form"/>
        </record>

        <record model="ir.actions.act_window" id="action_view_delivery_note">
            <field name="name">Delivery Note</field>
            <field name="res_model">delivery.note</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">form</field>
            <field name="view_mode">form,tree</field>
        </record>
        <record model="ir.actions.act_window.view" id="action_view_delivery_note_tree">
            <field name="sequence" eval="10"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="delivery_note_tree"/> 
            <field name="act_window_id" ref="action_view_delivery_note"/>
        </record>
        <record model="ir.actions.act_window.view" id="action_view_delivery_note_form">
            <field name="sequence" eval="20"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="delivery_note_form"/>
            <field name="act_window_id" ref="action_view_delivery_note"/>
        </record>
        <menuitem 
            name="Delivery Note" 
            id="menu_action_view_delivery_note_form"
            parent="account.menu_finance"
            action="action_view_delivery_note"/>

    <!--
    =======================
    DRAFT DELIVERY NOTE
    =======================
    -->
        <record model="ir.actions.act_window" id="action_view_delivery_note_draft">
            <field name="name">Draft Delivery Note</field>
            <field name="res_model">delivery.note</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('state','=','draft')]</field>
            <field name="context">{'state':'draft'}</field>
        </record>
        <record model="ir.actions.act_window.view" id="action_view_delivery_note_draft_tree">
            <field name="sequence" eval="10"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="delivery_note_tree"/> 
            <field name="act_window_id" ref="action_view_delivery_note_draft"/>
        </record>
        <record model="ir.actions.act_window.view" id="action_view_delivery_note_draft_form">
            <field name="sequence" eval="20"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="delivery_note_form"/>
            <field name="act_window_id" ref="action_view_delivery_note_draft"/>
        </record>
        <menuitem
            id="menu_action_view_delivery_note_draft"
            name="Draft Delivery Note"
            parent="menu_action_view_delivery_note_form"
            action="action_view_delivery_note_draft"/>

    <!--
    =======================
    INVOICED DELIVERY NOTE
    =======================
    -->
        <record model="ir.actions.act_window" id="action_view_delivery_note_invoiced">
            <field name="name">Invoiced Delivery Note</field>
            <field name="res_model">delivery.note</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('state','=','done')]</field>
            <field name="context">{'state':'done'}</field>
        </record>
        <record model="ir.actions.act_window.view" id="action_view_delivery_note_draft_tree">
            <field name="sequence" eval="10"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="delivery_note_tree"/> 
            <field name="act_window_id" ref="action_view_delivery_note_invoiced"/>
        </record>
        <record model="ir.actions.act_window.view" id="action_view_delivery_note_draft_form">
            <field name="sequence" eval="20"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="delivery_note_form"/>
            <field name="act_window_id" ref="action_view_delivery_note_invoiced"/>
        </record>
        <menuitem
            id="menu_action_view_delivery_note_invoiced"
            name="Invoiced Delivery Note"
            parent="menu_action_view_delivery_note_form"
            action="action_view_delivery_note_invoiced"/>

    </data>
</openerp>






